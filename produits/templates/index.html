<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- lien pour icon font awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <title>Product Catalog</title>
    
    <style>
        .button { padding: 5px 5px; border-radius: 10px; font-weight: bold; text-align: center; color: white; }
        .red { background-color: red; }
        .orange { background-color: orange; }
        .green { background-color: green; }
    </style>
</head>
<body>

    <nav class="minimal-menu">
        <a href="{% url 'home' %}" id="backHomeBtn" title="home">H
            <span class="material-icons">|<i class="fa-solid fa-chevron-left"></i></span>
        </a>
        <div class="menu-search">
            <span class="material-icons search-icon">S<i class="fa-solid fa-magnifying-glass"></i></span>
            <input id="searchInput" type="text" placeholder="Search products...">
        </div>
        <button id="filtersToggleBtn" title="Filters">
            <span class="material-icons">F<i class="fa-solid fa-filter"></i></span>
        </button>
        <button id="displayModeBtn" title="Display mode">
            <span class="material-icons" id="displayModeIcon">D<i class="fa-solid fa-list"></i></span>
        </button>
        <a href="{% url 'produits:add' %}" class="create-btn" id="createProductBtn" title="Add product">
            <span class="material-icons">A<i class="fa-solid fa-plus"></i></span>
        </a>
    </nav>

    <div id="filtersPanel" class="filters-panel hidden">
        <div class="filter-row">
            <label for="filterCategory">Category:</label>
            <select id="filterCategory">
                <option value="">All</option>
            </select>
        </div>
        <div class="filter-row">
            <label for="filterExpiry">Expires before:</label>
            <input id="filterExpiry" type="date">
        </div>
        <div class="filter-row">
            <label for="filterStock">Stock:</label>
            <select id="filterStock">
                <option value="">All</option>
                <option value="out">Out of stock</option>
                <option value="in">In stock</option>
          </select>
        </div>
        <div class="filter-row">
            <label for="filterPromo">On promotion:</label>
            <select id="filterPromo">
                <option value="">All</option>
                <option value="yes">On promotion</option>
          </select>
        </div>
        <div class="filter-row">
            <label for="sortPrice">Sort by price:</label>
            <select id="sortPrice">
                <option value="">None</option>
                <option value="asc">Cheapest first</option>
                <option value="desc">Most expensive first</option>
          </select>
        </div>
        <button class="action-btn" id="resetFiltersBtn" style="margin-top:8px;">Reset filters</button>
    </div>

    <main>
        <div id="product-container"></div>
        <h1 class="title">products</h1>
        <div id="product-list" class="product-list">
            {% for product in products %}
            <h1 class="product-name">{{ product.name }}</h1>
            <h3 class="product-category">{{ product.category }}</h3>
            <img class="product-image" src="{{ product.image }}" alt="{{ product.name }} image" style="max-width: 150px; max-height: 150px;">
            <p class="product-description">{{ product.description }}</p>
            <p class="product-date">product date : <span style="color: #0000ff;"> {{ product.productDate|date:'Y-m-d' }} </span></p>
            <span>quantity: </span><span class="status active"> <button class="button {{ product.quantity_available }}"></button> {{ product.quantity }}</span>
            <span>price: </span><span class="status active"> {{ product.price }}</span>
            <p class="product-date">expiry date : <span style="color: #ff0000;"> {{ product.expiryDate|date:'Y-m-d' }}</span></p>
            <div class="btn-action">
                <a href="{% url 'produits:update' product.pk %}" class="btn">U<i class="fa-regular fa-pen-to-square"></i></a>
                <a href="{% url 'produits:show' product.pk %}" class="btn">S<i class="fa-regular fa-eye"></i></a>
                <a href="{% url 'produits:delete' product.pk %}" class="btn">D<i class="fa-solid fa-trash"></i></a>
                {% comment %} <a href="{% url 'ventes:add' product.id %}" class="btn">V<i class="fa-solid fa-trash"></i></a> {% endcomment %}
            </div>
            {% endfor %}
        </div>
    </main>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            const searchInput = document.getElementById("searchInput");

            searchInput.addEventListener("keyup", function() {
                let query = searchInput.value.trim();

                if (query.lenght > 2) {
                    fetch(`/search/?product=${query}`).then(response => response.text()).then(data => { document.getElementById("product-list").innerHTML = data }).catch(error => console.log("erreur : ", error))
                }
            });
        });
    </script>
</body>
</html>